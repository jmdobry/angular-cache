!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("angular")):"function"==typeof define&&define.amd?define("angular-cache",["angular"],t):e.angularCacheModuleName=t(e.angular)}(this,function(e){"use strict";function t(){this.$get=function(){return u}}function r(){this.defaults=h,this.defaults.storagePrefix="angular-cache.caches.",this.$get=["$q",function(e){return $.Promise=e,new v}]}e="default"in e?e.default:e;var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},s="function"==typeof Symbol&&"symbol"===i(Symbol.iterator)?function(e){return"undefined"==typeof e?"undefined":i(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":"undefined"==typeof e?"undefined":i(e)},a=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},n=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),o=function(e,t,r){for(var i=e[r],s=t(i);r>0;){var a=Math.floor((r+1)/2)-1,n=e[a];if(s>=t(n))break;e[a]=i,e[r]=n,r=a}},c=function(e,t,r){for(var i=e.length,s=e[r],a=t(s);;){var n=2*(r+1),o=n-1,c=null;if(o<i){var u=e[o],h=t(u);h<a&&(c=o)}if(n<i){var l=e[n],$=t(l);$<(null===c?a:t(e[o]))&&(c=n)}if(null===c)break;e[r]=e[c],e[c]=s,r=c}},u=function(){function e(t,r){if(a(this,e),t||(t=function(e){return e}),r||(r=function(e,t){return e===t}),"function"!=typeof t)throw new Error('BinaryHeap([weightFunc][, compareFunc]): "weightFunc" must be a function!');if("function"!=typeof r)throw new Error('BinaryHeap([weightFunc][, compareFunc]): "compareFunc" must be a function!');this.weightFunc=t,this.compareFunc=r,this.heap=[]}return n(e,[{key:"push",value:function(e){this.heap.push(e),o(this.heap,this.weightFunc,this.heap.length-1)}},{key:"peek",value:function(){return this.heap[0]}},{key:"pop",value:function(){var e=this.heap[0],t=this.heap.pop();return this.heap.length>0&&(this.heap[0]=t,c(this.heap,this.weightFunc,0)),e}},{key:"remove",value:function(e){for(var t=this.heap.length,r=0;r<t;r++)if(this.compareFunc(this.heap[r],e)){var i=this.heap[r],s=this.heap.pop();return r!==t-1&&(this.heap[r]=s,o(this.heap,this.weightFunc,r),c(this.heap,this.weightFunc,r)),i}return null}},{key:"removeAll",value:function(){this.heap=[]}},{key:"size",value:function(){return this.heap.length}}]),e}(),h={capacity:Number.MAX_VALUE,cacheFlushInterval:null,deleteOnExpire:"none",enabled:!0,onExpire:null,maxAge:Number.MAX_VALUE,recycleFreq:1e3,storageMode:"memory",storageImpl:null,storagePrefix:"cachefactory.caches.",storeOnReject:!1,storeOnResolve:!1},l=null;try{l=window.Promise}catch(e){}var $={equals:function(e,t){return e===t},fromJson:function(e){return JSON.parse(e)},isFunction:function(e){return"function"==typeof e},isNumber:function(e){return"number"==typeof e},isObject:function(e){return null!==e&&"object"===("undefined"==typeof e?"undefined":s(e))},isPromise:function(e){return e&&$.isFunction(e.then)},isString:function(e){return"string"==typeof e},toJson:function(e){return JSON.stringify(e)},Promise:l},f="Cannot assign to read only property",p=function(){function e(t){var r=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(a(this,e),!$.isString(t))throw new TypeError('"id" must be a string!');Object.defineProperties(this,{$$cacheFlushInterval:{writable:!0,value:void 0},$$cacheFlushIntervalId:{writable:!0,value:void 0},$$capacity:{writable:!0,value:void 0},$$data:{writable:!0,value:{}},$$deleteOnExpire:{writable:!0,value:void 0},$$enabled:{writable:!0,value:void 0},$$expiresHeap:{writable:!0,value:new u(function(e){return e.accessed},$.equals)},$$initializing:{writable:!0,value:!0},$$lruHeap:{writable:!0,value:new u(function(e){return e.accessed},$.equals)},$$maxAge:{writable:!0,value:void 0},$$onExpire:{writable:!0,value:void 0},$$prefix:{writable:!0,value:""},$$promises:{writable:!0,value:{}},$$recycleFreq:{writable:!0,value:void 0},$$recycleFreqId:{writable:!0,value:void 0},$$storage:{writable:!0,value:void 0},$$storageMode:{writable:!0,value:void 0},$$storagePrefix:{writable:!0,value:void 0},$$storeOnReject:{writable:!0,value:void 0},$$storeOnResolve:{writable:!0,value:void 0},$$parent:{value:i.parent},cacheFlushInterval:{enumerable:!0,get:function(){return r.$$cacheFlushInterval},set:function(){throw new Error(f+" 'cacheFlushInterval'")}},capacity:{enumerable:!0,get:function(){return r.$$capacity},set:function(){throw new Error(f+" 'capacity'")}},deleteOnExpire:{enumerable:!0,get:function(){return r.$$deleteOnExpire},set:function(){throw new Error(f+" 'deleteOnExpire'")}},enabled:{enumerable:!0,get:function(){return r.$$enabled},set:function(){throw new Error(f+" 'enabled'")}},id:{enumerable:!0,value:t},maxAge:{enumerable:!0,get:function(){return r.$$maxAge},set:function(){throw new Error(f+" 'maxAge'")}},onExpire:{enumerable:!0,get:function(){return r.$$onExpire},set:function(){throw new Error(f+" 'onExpire'")}},recycleFreq:{enumerable:!0,get:function(){return r.$$recycleFreq},set:function(){throw new Error(f+" 'recycleFreq'")}},storageMode:{enumerable:!0,get:function(){return r.$$storageMode},set:function(){throw new Error(f+" 'storageMode'")}},storagePrefix:{enumerable:!0,get:function(){return r.$$storagePrefix},set:function(){throw new Error(f+" 'storagePrefix'")}},storeOnReject:{enumerable:!0,get:function(){return r.$$storeOnReject},set:function(){throw new Error(f+" 'storeOnReject'")}},storeOnResolve:{enumerable:!0,get:function(){return r.$$storeOnResolve},set:function(){throw new Error(f+" 'storeOnResolve'")}}}),this.setOptions(i,!0),this.$$initializing=!1}return n(e,[{key:"destroy",value:function(){clearInterval(this.$$cacheFlushIntervalId),clearInterval(this.$$recycleFreqId),this.removeAll(),this.$$storage&&(this.$$storage().removeItem(this.$$prefix+".keys"),this.$$storage().removeItem(this.$$prefix)),this.$$storage=null,this.$$data=null,this.$$lruHeap=null,this.$$expiresHeap=null,this.$$prefix=null,this.$$parent&&(this.$$parent.caches[this.id]=void 0)}},{key:"disable",value:function(){this.$$enabled=!1}},{key:"enable",value:function(){this.$$enabled=!0}},{key:"get",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(Array.isArray(e)){var i=e,s=[];return i.forEach(function(e){var i=t.get(e,r);null!==i&&void 0!==i&&s.push(i)}),s}if($.isNumber(e)&&(e=""+e),this.enabled){if(!$.isString(e))throw new TypeError('"key" must be a string!');if(!r||!$.isObject(r))throw new TypeError('"options" must be an object!');if(r.onExpire&&!$.isFunction(r.onExpire))throw new TypeError('"options.onExpire" must be a function!');var a=void 0;if(this.$$storage){if(this.$$promises[e])return this.$$promises[e];var n=this.$$storage().getItem(this.$$prefix+".data."+e);n&&(a=$.fromJson(n))}else $.isObject(this.$$data)&&(a=this.$$data[e]);if(a){var o=a.value,c=(new Date).getTime();return this.$$storage?(this.$$lruHeap.remove({key:e,accessed:a.accessed}),a.accessed=c,this.$$lruHeap.push({key:e,accessed:c})):(this.$$lruHeap.remove(a),a.accessed=c,this.$$lruHeap.push(a)),"passive"===this.$$deleteOnExpire&&"expires"in a&&a.expires<c?(this.remove(e),this.$$onExpire?this.$$onExpire(e,a.value,r.onExpire):r.onExpire&&r.onExpire.call(this,e,a.value),o=void 0):this.$$storage&&this.$$storage().setItem(this.$$prefix+".data."+e,$.toJson(a)),o}}}},{key:"info",value:function(e){if(!e)return{id:this.id,capacity:this.capacity,maxAge:this.maxAge,deleteOnExpire:this.deleteOnExpire,onExpire:this.onExpire,cacheFlushInterval:this.cacheFlushInterval,recycleFreq:this.recycleFreq,storageMode:this.storageMode,storageImpl:this.$$storage?this.$$storage():void 0,enabled:this.enabled,size:this.$$lruHeap&&this.$$lruHeap.size()||0};var t=void 0;if(this.$$storage){var r=this.$$storage().getItem(this.$$prefix+".data."+e);r&&(t=$.fromJson(r))}else $.isObject(this.$$data)&&(t=this.$$data[e]);return t?{created:t.created,accessed:t.accessed,expires:t.expires,isExpired:(new Date).getTime()-t.created>(t.maxAge||this.$$maxAge)}:void 0}},{key:"keys",value:function(){var e=this;if(this.$$storage){var t=this.$$storage().getItem(this.$$prefix+".keys");return t?$.fromJson(t):[]}return Object.keys(this.$$data).filter(function(t){return e.$$data[t]})}},{key:"keySet",value:function(){var e={};return this.keys().forEach(function(t){e[t]=t}),e}},{key:"put",value:function(e,t){var r=this,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},s=void 0!==i.storeOnResolve?!!i.storeOnResolve:this.$$storeOnResolve,a=void 0!==i.storeOnReject?!!i.storeOnReject:this.$$storeOnReject,n=function(t,i){return function(s){if(t&&(r.$$promises[e]=void 0,$.isObject(s)&&"status"in s&&"data"in s?r.put(e,[s.status,s.data,s.headers(),s.statusText]):r.put(e,s)),i){if($.Promise)return $.Promise.reject(s);throw s}return s}};if(this.$$enabled&&$.isObject(this.$$data)&&null!==t&&void 0!==t){if($.isNumber(e)&&(e=""+e),!$.isString(e))throw new TypeError('"key" must be a string!');var o=(new Date).getTime(),c={key:e,value:$.isPromise(t)?t.then(n(s,!1),n(a,!0)):t,created:void 0===i.created?o:i.created,accessed:void 0===i.accessed?o:i.accessed};if($.isNumber(i.maxAge)&&(c.maxAge=i.maxAge),void 0===i.expires?c.expires=c.created+(c.maxAge||this.$$maxAge):c.expires=i.expires,this.$$storage){if($.isPromise(c.value))return this.$$promises[e]=c.value,this.$$promises[e];var u=this.$$storage().getItem(this.$$prefix+".keys"),h=u?$.fromJson(u):[],l=this.$$storage().getItem(this.$$prefix+".data."+e);l&&this.remove(e),this.$$expiresHeap.push({key:e,expires:c.expires}),this.$$lruHeap.push({key:e,accessed:c.accessed}),this.$$storage().setItem(this.$$prefix+".data."+e,$.toJson(c));var f=!1;h.forEach(function(t){if(t===e)return f=!0,!1}),f||h.push(e),this.$$storage().setItem(this.$$prefix+".keys",$.toJson(h))}else this.$$data[e]&&this.remove(e),this.$$expiresHeap.push(c),this.$$lruHeap.push(c),this.$$data[e]=c,this.$$promises[e]=void 0;return this.$$lruHeap.size()>this.$$capacity&&this.remove(this.$$lruHeap.peek().key),t}}},{key:"remove",value:function(e){if($.isNumber(e)&&(e=""+e),this.$$promises[e]=void 0,this.$$storage){var t=this.$$storage().getItem(this.$$prefix+".data."+e);if(t){var r=$.fromJson(t);this.$$lruHeap.remove({key:e,accessed:r.accessed}),this.$$expiresHeap.remove({key:e,expires:r.expires}),this.$$storage().removeItem(this.$$prefix+".data."+e);var i=this.$$storage().getItem(this.$$prefix+".keys"),s=i?$.fromJson(i):[],a=s.indexOf(e);return a>=0&&s.splice(a,1),this.$$storage().setItem(this.$$prefix+".keys",$.toJson(s)),r.value}}else if($.isObject(this.$$data)){var n=this.$$data[e]?this.$$data[e].value:void 0;return this.$$lruHeap.remove(this.$$data[e]),this.$$expiresHeap.remove(this.$$data[e]),this.$$data[e]=void 0,n}}},{key:"removeAll",value:function(){var e=this,t=this.$$storage,r=this.keys();this.$$lruHeap.removeAll(),this.$$expiresHeap.removeAll(),t?(t().setItem(this.$$prefix+".keys",$.toJson([])),r.forEach(function(r){t().removeItem(e.$$prefix+".data."+r)})):$.isObject(this.$$data)&&(this.$$data={}),this.$$promises={}}},{key:"removeExpired",value:function(){for(var e=this,t=(new Date).getTime(),r={},i=void 0;(i=this.$$expiresHeap.peek())&&i.expires<=t;)r[i.key]=i.value?i.value:null,this.$$expiresHeap.pop();return Object.keys(r).forEach(function(t){e.remove(t)}),this.$$onExpire&&Object.keys(r).forEach(function(t){e.$$onExpire(t,r[t])}),r}},{key:"setCacheFlushInterval",value:function(e){var t=this;if(null===e)this.$$cacheFlushInterval=null;else{if(!$.isNumber(e))throw new TypeError('"cacheFlushInterval" must be a number!');if(e<=0)throw new Error('"cacheFlushInterval" must be greater than zero!')}this.$$cacheFlushInterval=e,clearInterval(this.$$cacheFlushIntervalId),this.$$cacheFlushIntervalId=void 0,this.$$cacheFlushInterval&&(this.$$cacheFlushIntervalId=setInterval(function(){return t.removeAll()},this.$$cacheFlushInterval))}},{key:"setCapacity",value:function(e){if(null===e)this.$$capacity=Number.MAX_VALUE;else{if(!$.isNumber(e))throw new TypeError('"capacity" must be a number!');if(e<=0)throw new Error('"capacity" must be greater than zero!');this.$$capacity=e}for(var t={};this.$$lruHeap.size()>this.$$capacity;)t[this.$$lruHeap.peek().key]=this.remove(this.$$lruHeap.peek().key);return t}},{key:"setDeleteOnExpire",value:function(e,t){if(null===e)e="none";else{if(!$.isString(e))throw new TypeError('"deleteOnExpire" must be a string!');if("none"!==e&&"passive"!==e&&"aggressive"!==e)throw new Error('"deleteOnExpire" must be "none", "passive" or "aggressive"!')}this.$$deleteOnExpire=e,t!==!1&&this.setRecycleFreq(this.$$recycleFreq)}},{key:"setMaxAge",value:function(e){var t=this;if(null===e)this.$$maxAge=Number.MAX_VALUE;else{if(!$.isNumber(e))throw new TypeError('"maxAge" must be a number!');if(e<=0)throw new Error('"maxAge" must be greater than zero!');this.$$maxAge=e}var r=this.keys();return this.$$expiresHeap.removeAll(),this.$$storage?r.forEach(function(e){var r=t.$$storage().getItem(t.$$prefix+".data."+e);if(r){var i=$.fromJson(r);t.$$maxAge===Number.MAX_VALUE?i.expires=Number.MAX_VALUE:i.expires=i.created+(i.maxAge||t.$$maxAge),t.$$expiresHeap.push({key:e,expires:i.expires})}}):r.forEach(function(e){var r=t.$$data[e];r&&(t.$$maxAge===Number.MAX_VALUE?r.expires=Number.MAX_VALUE:r.expires=r.created+(r.maxAge||t.$$maxAge),t.$$expiresHeap.push(r))}),"aggressive"===this.$$deleteOnExpire?this.removeExpired():{}}},{key:"setOnExpire",value:function(e){if(null===e)this.$$onExpire=null;else{if(!$.isFunction(e))throw new TypeError('"onExpire" must be a function!');this.$$onExpire=e}}},{key:"setOptions",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!$.isObject(e))throw new TypeError('"options" must be an object!');void 0!==e.storagePrefix?this.$$storagePrefix=e.storagePrefix:t&&(this.$$storagePrefix=h.storagePrefix),this.$$prefix=this.$$storagePrefix+this.id,void 0!==e.enabled?this.$$enabled=!!e.enabled:t&&(this.$$enabled=h.enabled),void 0!==e.deleteOnExpire?this.setDeleteOnExpire(e.deleteOnExpire,!1):t&&this.setDeleteOnExpire(h.deleteOnExpire,!1),void 0!==e.recycleFreq?this.setRecycleFreq(e.recycleFreq):t&&this.setRecycleFreq(h.recycleFreq),void 0!==e.maxAge?this.setMaxAge(e.maxAge):t&&this.setMaxAge(h.maxAge),void 0!==e.storeOnResolve?this.$$storeOnResolve=!!e.storeOnResolve:t&&(this.$$storeOnResolve=h.storeOnResolve),void 0!==e.storeOnReject?this.$$storeOnReject=!!e.storeOnReject:t&&(this.$$storeOnReject=h.storeOnReject),void 0!==e.capacity?this.setCapacity(e.capacity):t&&this.setCapacity(h.capacity),void 0!==e.cacheFlushInterval?this.setCacheFlushInterval(e.cacheFlushInterval):t&&this.setCacheFlushInterval(h.cacheFlushInterval),void 0!==e.onExpire?this.setOnExpire(e.onExpire):t&&this.setOnExpire(h.onExpire),void 0!==e.storageMode||void 0!==e.storageImpl?this.setStorageMode(e.storageMode||h.storageMode,e.storageImpl||h.storageImpl):t&&this.setStorageMode(h.storageMode,h.storageImpl)}},{key:"setRecycleFreq",value:function(e){var t=this;if(null===e)this.$$recycleFreq=null;else{if(!$.isNumber(e))throw new TypeError('"recycleFreq" must be a number!');if(e<=0)throw new Error('"recycleFreq" must be greater than zero!');this.$$recycleFreq=e}clearInterval(this.$$recycleFreqId),"aggressive"===this.$$deleteOnExpire&&this.$$recycleFreq?this.$$recycleFreqId=setInterval(function(){return t.removeExpired()},this.$$recycleFreq):this.$$recycleFreqId=void 0}},{key:"setStorageMode",value:function(e,t){var r=this;if(!$.isString(e))throw new TypeError('"storageMode" must be a string!');if("memory"!==e&&"localStorage"!==e&&"sessionStorage"!==e)throw new Error('"storageMode" must be "memory", "localStorage", or "sessionStorage"!');var i=this.$$storage,s=this.$$data,a=!1,n={},o=function(e,t){var i=r.keys(),s=$.isObject(t);i.forEach(function(i){if(e){var o=e().getItem(r.$$prefix+".data."+i);o&&(n[i]=$.fromJson(o))}else s&&(n[i]=t[i]);r.remove(i),a||(a=!0)})};if(this.$$initializing||o(i,s),this.$$storageMode=e,t){if(!$.isObject(t))throw new TypeError('"storageImpl" must be an object!');if("function"!=typeof t.setItem)throw new Error('"storageImpl" must implement "setItem(key, value)"!');if("function"!=typeof t.getItem)throw new Error('"storageImpl" must implement "getItem(key)"!');if("function"!=typeof t.removeItem)throw new Error('"storageImpl" must implement "removeItem(key)"!');this.$$storage=function(){return t}}else if("localStorage"===this.$$storageMode)try{localStorage.setItem("cachefactory","cachefactory"),localStorage.removeItem("cachefactory"),this.$$storage=function(){return localStorage}}catch(e){this.$$storage=null,this.$$storageMode="memory"}else if("sessionStorage"===this.$$storageMode)try{sessionStorage.setItem("cachefactory","cachefactory"),sessionStorage.removeItem("cachefactory"),this.$$storage=function(){return sessionStorage}}catch(e){this.$$storage=null,this.$$storageMode="memory"}else this.$$storage=null,this.$$storageMode="memory";this.$$initializing&&o(this.$$storage,this.$$data),a&&Object.keys(n).forEach(function(e){var t=n[e];r.put(e,t.value,{created:t.created,accessed:t.accessed,expires:t.expires})})}},{key:"touch",value:function(e,t){var r=this;if(e){var i=this.get(e,{onExpire:function(e,t){return r.put(e,t)}});i&&this.put(e,i,t)}else for(var s=this.keys(),a=0;a<s.length;a++)this.touch(s[a],t)}},{key:"values",value:function(){var e=this;return this.keys().map(function(t){return e.get(t)})}}]),e}(),v=function(){function e(){a(this,e),Object.defineProperty(this,"caches",{writable:!0,value:{}})}return n(e,[{key:"clearAll",value:function(){var e=this;this.keys().forEach(function(t){e.get(t).removeAll()})}},{key:"createCache",value:function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(this.caches[t])throw new Error('cache "'+t+'" already exists!');return r.parent=this,this.caches[t]=new e.Cache(t,r),this.caches[t]}},{key:"destroy",value:function(e){this.get(e).destroy(),this.caches[e]=void 0}},{key:"destroyAll",value:function(){var e=this;this.keys().forEach(function(t){e.get(t).destroy()}),this.caches={}}},{key:"disableAll",value:function(){var e=this;this.keys().forEach(function(t){e.get(t).disable()})}},{key:"enableAll",value:function(){var e=this;this.keys().forEach(function(t){e.get(t).enable()})}},{key:"exists",value:function(e){return!!this.caches[e]}},{key:"get",value:function(e){var t=this.caches[e];if(!t)throw new ReferenceError('Cache "'+e+'" does not exist!');return t}},{key:"info",value:function e(){var t=this,r=this.keys(),e={size:r.length,caches:{}};return r.forEach(function(r){e.caches[r]=t.get(r).info()}),Object.keys(h).forEach(function(t,r){e[t]=h[t]}),e}},{key:"keys",value:function(){var e=this;return Object.keys(this.caches).filter(function(t){return e.caches[t]})}},{key:"keySet",value:function(){var e={};return this.keys().forEach(function(t){e[t]=t}),e}},{key:"removeExpiredFromAll",value:function(){var e=this,t={};return this.keys().forEach(function(r){t[r]=e.get(r).removeExpired()}),t}},{key:"touchAll",value:function(){var e=this;this.keys().forEach(function(t){e.get(t).touch()})}}]),e}();v.Cache=p,$.equals=e.equals,$.isObject=e.isObject,$.fromJson=e.fromJson,e.module("angular-cache",[]).provider("BinaryHeap",t).provider("CacheFactory",r);var d="angular-cache";return d});
//# sourceMappingURL=angular-cache.min.map