!function(a,b){"use strict";function c(){this.$get=["$timeout","$window",function(a,c){function d(a){var b,c={};for(b in a)a.hasOwnProperty(b)&&(c[b]=b);return c}function e(a){var b,c=[];for(b in a)a.hasOwnProperty(b)&&c.push(b);return c}function f(f,g){function i(b,c){w[b].timeoutId=a(function(){var a;w[b]&&(a=w[b].value),C.remove(b),v.onExpire&&v.onExpire(b,a)},c)}function j(a,c){b.isNumber(a)?0>a?c("must be greater than zero!",a):c(null,a):c("must be a number!",a)}function k(a,b){a===Number.MAX_VALUE?(v.capacity=a,b(null,v.capacity)):j(a,function(a,c){if(a)b(a,c);else{for(v.capacity=c;u>v.capacity;)C.remove(z.key);b(null,v.capacity)}})}function l(a,b){null===a?(v.aggressiveDelete=!1,b(null,v.aggressiveDelete)):a===!0||a===!1?(v.aggressiveDelete=a,b(null,v.aggressiveDelete)):b("must be a boolean!",a)}function m(b,c){var d=e(w);if(null===b){v.maxAge=b;for(var f=0;f<d.length;f++){var g=d[f];w[g].timeoutId&&!w[g].maxAge&&a.cancel(w[g].timeoutId)}c(null,v.maxAge)}else j(b,function(b,e){if(b)c(b,e);else{v.maxAge=e;for(var f=0;f<d.length;f++){var g=d[f];if(!w[g].maxAge){w[g].timeoutId&&a.cancel(w[g].timeoutId);var h=(new Date).getTime()-w[g].timestamp;v.maxAge-h>0&&v.aggressiveDelete?i(g,v.maxAge):C.remove(g)}}c(null,v.maxAge)}})}function n(b,c){v.cacheFlushIntervalId&&(clearInterval(v.cacheFlushIntervalId),delete v.cacheFlushIntervalId),null===b?(v.cacheFlushInterval=b,c(null,v.cacheFlushInterval)):j(b,function(b,d){b?c(b,d):(v.cacheFlushInterval=d,v.cacheFlushIntervalId=setInterval(function(){for(var b=e(w),c=0;c<b.length;c++){var d=b[c];v.storageMode&&D.removeItem(A+".data."+d),w[d].timeoutId&&a.cancel(w[d].timeoutId)}u=0,w={},x={},y=null,z=null,t(null)},v.cacheFlushInterval),c(null,v.cacheFlushInterval))})}function o(a,d,f,g){var h,i;if("localStorage"!==v.storageMode&&"sessionStorage"!==v.storageMode||"localStorage"===f||"sessionStorage"===f)switch(f){case"localStorage":if(a||c.localStorage)if(v.storageMode=f,D=a||c.localStorage,B)for(t(null),h=e(w),i=0;i<h.length;i++)D.setItem(A+".data."+h[i],b.toJson(w[h[i]]));else s();break;case"sessionStorage":if(d||c.sessionStorage)if(v.storageMode=f,D=d||c.sessionStorage,B)for(t(null),h=e(w),i=0;i<h.length;i++)D.setItem(A+".data."+h[i],b.toJson(w[h[i]]));else s();break;default:v.storageMode=null,D=null}else{for(h=e(w),i=0;i<h.length;i++)D.removeItem(A+".data."+h[i]);D.removeItem(A+".keys"),v.storageMode=null,D=null}g(null,v.storageMode)}function p(a,b){if(b=b||!1,(a.capacity||b)&&k(a.capacity?a.capacity:Number.MAX_VALUE,function(a){if(a)throw new Error("capacity: "+a)}),(a.hasOwnProperty("aggressiveDelete")||b)&&l(a.hasOwnProperty("aggressiveDelete")?a.aggressiveDelete:null,function(a){if(a)throw new Error("aggressiveDelete: "+a)}),a.maxAge||b||(a.maxAge=v.maxAge),(a.maxAge||b)&&m(a.maxAge?a.maxAge:null,function(a){if(a)throw new Error("maxAge: "+a)}),(a.cacheFlushInterval||b)&&n(a.cacheFlushInterval?a.cacheFlushInterval:null,function(a){if(a)throw new Error("cacheFlushInterval: "+a)}),(a.storageMode||b)&&o(a.localStorageImpl?a.localStorageImpl:null,a.sessionStorageImpl?a.sessionStorageImpl:null,a.storageMode?a.storageMode:null,function(a){if(a)throw new Error("storageMode: "+a)}),b&&delete v.onExpire,a.onExpire){if("function"!=typeof a.onExpire)throw new Error("onExpire: Must be a function!");v.onExpire=a.onExpire}B=!0}function q(a){a!==y&&(z?z===a&&(z=a.n):z=a,r(a.n,a.p),r(a,y),y=a,y.n=null)}function r(a,b){a!==b&&(a&&(a.p=b),b&&(b.n=a))}function s(){var a=b.fromJson(D.getItem(A+".keys"));if(D.removeItem(A+".keys"),a&&a.length){for(var c=0;c<a.length;c++){var d=b.fromJson(D.getItem(A+".data."+a[c])),e=d.maxAge||v.maxAge;if(e&&(new Date).getTime()-d.timestamp>e)D.removeItem(A+".data."+a[c]);else{var f={timestamp:d.timestamp};d.maxAge&&(f.maxAge=d.maxAge),d.hasOwnProperty("aggressiveDelete")&&(f.aggressiveDelete=d.aggressiveDelete),C.put(a[c],d.value,f)}}t(null,null)}}function t(a){v.storageMode&&D&&(D.setItem(A+".keys",b.toJson(e(w))),a&&D.setItem(A+".data."+a,b.toJson(w[a])))}var u=0,v=b.extend({},{id:f}),w={},x={},y=null,z=null,A="angular-cache.caches."+f,B=!1,C=this,D=null;g=g||{},g.hasOwnProperty("aggressiveDelete")||(g.aggressiveDelete=!1),this.put=function(c,d,e){if(!b.isString(c))throw new Error("The key must be a string!");if(e&&e.maxAge&&j(e.maxAge,function(a){if(a)throw new Error("AngularCache.put(): maxAge: "+a)}),e&&e.hasOwnProperty("aggressiveDelete")&&e.aggressiveDelete!==!0&&e.aggressiveDelete!==!1)throw new Error("AngularCache.put(): aggressiveDelete must be a boolean!");if(!b.isUndefined(d)){var f=x[c]||(x[c]={key:c});return q(f),c in w?w[c].timeoutId&&a.cancel(w[c].timeoutId):u++,w[c]={value:d},e&&e.maxAge&&(w[c].maxAge=e.maxAge),e&&e.hasOwnProperty("aggressiveDelete")&&(w[c].aggressiveDelete=e.aggressiveDelete),w[c].timestamp=e&&e.timestamp||(new Date).getTime(),(e&&e.maxAge||v.maxAge)&&(w[c].aggressiveDelete||!w[c].hasOwnProperty("aggressiveDelete")&&v.aggressiveDelete)&&i(c,e&&e.maxAge||v.maxAge),t(c),u>v.capacity&&this.remove(z.key),d}},this.get=function(a,b){var c,d,e=x[a],f=w[a];if(e&&f)return c=f.maxAge||v.maxAge,d=f.hasOwnProperty("aggressiveDelete")?f.aggressiveDelete:v.aggressiveDelete,!d&&c&&(new Date).getTime()-f.timestamp>c?(this.remove(a),e=null,v.onExpire?(v.onExpire(a,f.value,b),void 0):b&&"function"==typeof b?(b(a,f.value),void 0):void 0):(q(e),t(a),f.value)},this.remove=function(a){var b=x[a];b&&(b===y&&(y=b.p),b===z&&(z=b.n),r(b.n,b.p),delete x[a],delete w[a],t(null),v.storageMode&&D.removeItem(A+".data."+a),u--)},this.removeAll=function(){if(v.storageMode)for(var a=e(w),b=0;b<a.length;b++)D.removeItem(A+".data."+a[b]);w={},u=0,x={},y=null,z=null,v.storageMode&&t()},this.destroy=function(){clearInterval(v.cacheFlushIntervalId),v.storageMode&&(this.removeAll(),D.removeItem(A+".keys"),D.removeItem(A)),w=null,v=null,x=null,u=null,y=null,z=null,A=null,C=null,delete h[f]},this.info=function(a){if(a){if(w[a]){var c={timestamp:w[a].timestamp,maxAge:w[a].maxAge||v.maxAge,aggressiveDelete:w[a].aggressiveDelete||!w[a].hasOwnProperty("aggressiveDelete")&&v.aggressiveDelete||!1,isExpired:!1};return c.maxAge&&(c.isExpired=(new Date).getTime()-c.timestamp>c.maxAge),c}return w[a]}return b.extend({},v,{size:u})},this.keySet=function(){return d(w)},this.keys=function(){return e(w)},this.setOptions=p,p(g,!0)}function g(a,c){if(a in h)throw new Error("cacheId "+a+" taken!");if(!b.isString(a))throw new Error("cacheId must be a string!");return h[a]=new f(a,c),h[a]}var h={};return g.info=function(){for(var a={},b=e(h),c=0;c<b.length;c++){var d=b[c];a[d]=h[d].info()}return a},g.get=function(a){return h[a]},g.keySet=function(){return d(h)},g.keys=function(){return e(h)},g.removeAll=function(){for(var a=e(h),b=0;b<a.length;b++)h[a[b]].destroy()},g.clearAll=function(){for(var a=e(h),b=0;b<a.length;b++)h[a[b]].removeAll()},g}]}b.module("angular-cache",["ng"]),b.module("angular-cache").provider("$angularCacheFactory",c)}(window,window.angular);