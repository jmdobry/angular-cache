!function(a,b){"use strict";function c(){this.$get=["$timeout","$window",function(a,c){function d(a){var b,c={};for(b in a)a.hasOwnProperty(b)&&(c[b]=b);return c}function e(a){var b,c=[];for(b in a)a.hasOwnProperty(b)&&c.push(b);return c}function f(f,g){function i(b,c){w[b].timeoutId=a(function(){var a;w[b]&&(a=w[b].value),C.remove(b),v.onExpire&&v.onExpire(b,a)},c)}function j(a,c){b.isNumber(a)?0>a?c("must be greater than zero!",a):c(null,a):c("must be a number!",a)}function k(a,b){a===Number.MAX_VALUE?(v.capacity=a,b(null,v.capacity)):j(a,function(a,c){if(a)b(a,c);else{for(v.capacity=c;u>v.capacity;)C.remove(z.key);b(null,v.capacity)}})}function l(a,c){null===a?(v.deleteOnExpire="none",c(null,v.deleteOnExpire)):b.isString(a)?(v.deleteOnExpire=a,c(null,v.deleteOnExpire)):c("must be a string!",a)}function m(b,c){var d=e(w);if(null===b){v.maxAge=b;for(var f=0;f<d.length;f++){var g=d[f];w[g].timeoutId&&!w[g].maxAge&&a.cancel(w[g].timeoutId)}c(null,v.maxAge)}else j(b,function(b,e){if(b)c(b,e);else{v.maxAge=e;for(var f=0;f<d.length;f++){var g=d[f];if(!w[g].maxAge){w[g].timeoutId&&a.cancel(w[g].timeoutId);var h=(new Date).getTime()-w[g].timestamp;v.maxAge-h>0&&"aggressive"===v.deleteOnExpire?i(g,v.maxAge):C.remove(g)}}c(null,v.maxAge)}})}function n(b,c){v.cacheFlushIntervalId&&(clearInterval(v.cacheFlushIntervalId),delete v.cacheFlushIntervalId),null===b?(v.cacheFlushInterval=b,c(null,v.cacheFlushInterval)):j(b,function(b,d){b?c(b,d):(v.cacheFlushInterval=d,v.cacheFlushIntervalId=setInterval(function(){for(var b=e(w),c=0;c<b.length;c++){var d=b[c];w[d].timeoutId&&a.cancel(w[d].timeoutId)}u=0,w={},x={},y=null,z=null},v.cacheFlushInterval),c(null,v.cacheFlushInterval))})}function o(a,b,d,f){var g,h;if("localStorage"!==v.storageMode&&"sessionStorage"!==v.storageMode||"localStorage"===d||"sessionStorage"===d)switch(d){case"localStorage":if(a||c.localStorage)if(v.storageMode=d,D=a||c.localStorage,B)for(g=e(w),h=0;h<g.length;h++)t(g[h]);else s();break;case"sessionStorage":if(b||c.sessionStorage)if(v.storageMode=d,D=b||c.sessionStorage,B)for(g=e(w),h=0;h<g.length;h++)t(g[h]);else s();break;default:v.storageMode=null,D=null}else{for(g=e(w),h=0;h<g.length;h++)D.removeItem(A+".data."+g[h]);D.removeItem(A+".keys"),v.storageMode=null,D=null}f(null,v.storageMode)}function p(a,b){if(b=b||!1,(a.capacity||b)&&k(a.capacity?a.capacity:Number.MAX_VALUE,function(a){if(a)throw new Error("capacity: "+a)}),(a.deleteOnExpire||b)&&l(a.deleteOnExpire?a.deleteOnExpire:null,function(a){if(a)throw new Error("deleteOnExpire: "+a)}),a.maxAge||b||(a.maxAge=v.maxAge),(a.maxAge||b)&&m(a.maxAge?a.maxAge:null,function(a){if(a)throw new Error("maxAge: "+a)}),(a.cacheFlushInterval||b)&&n(a.cacheFlushInterval?a.cacheFlushInterval:null,function(a){if(a)throw new Error("cacheFlushInterval: "+a)}),(a.storageMode||b)&&o(a.localStorageImpl?a.localStorageImpl:null,a.sessionStorageImpl?a.sessionStorageImpl:null,a.storageMode?a.storageMode:null,function(a){if(a)throw new Error("storageMode: "+a)}),b&&delete v.onExpire,a.onExpire){if("function"!=typeof a.onExpire)throw new Error("onExpire: Must be a function!");v.onExpire=a.onExpire}B=!0}function q(a){a!==y&&(z?z===a&&(z=a.n):z=a,r(a.n,a.p),r(a,y),y=a,y.n=null)}function r(a,b){a!==b&&(a&&(a.p=b),b&&(b.n=a))}function s(){var a=b.fromJson(D.getItem(A+".keys"));if(D.removeItem(A+".keys"),a&&a.length){for(var c=0;c<a.length;c++){var d=b.fromJson(D.getItem(A+".data."+a[c])),e=d.maxAge||v.maxAge,f=d.deleteOnExpire||v.deleteOnExpire;if(e&&(new Date).getTime()-d.timestamp>e&&"aggressive"===f)D.removeItem(A+".data."+a[c]);else{var g={timestamp:d.timestamp};d.maxAge&&(g.maxAge=d.maxAge),d.deleteOnExpire&&(g.deleteOnExpire=d.deleteOnExpire),C.put(a[c],d.value,g)}}t(null)}}function t(a){v.storageMode&&D&&(D.setItem(A+".keys",b.toJson(e(w))),a&&D.setItem(A+".data."+a,b.toJson(w[a])))}var u=0,v=b.extend({},{id:f}),w={},x={},y=null,z=null,A="angular-cache.caches."+f,B=!1,C=this,D=null;g=g||{},this.put=function(c,d,e){if(!b.isString(c))throw new Error("AngularCache.put(): key: must be a string!");if(e&&e.maxAge&&j(e.maxAge,function(a){if(a)throw new Error("AngularCache.put(): maxAge: "+a)}),e&&e.deleteOnExpire&&!b.isString(e.deleteOnExpire))throw new Error("AngularCache.put(): deleteOnExpire: must be a string!");if(!b.isUndefined(d)){var f=x[c]||(x[c]={key:c});return q(f),c in w?w[c].timeoutId&&a.cancel(w[c].timeoutId):u++,w[c]={value:d,timestamp:e&&e.timestamp||(new Date).getTime()},e&&e.deleteOnExpire&&(w[c].deleteOnExpire=e.deleteOnExpire),e&&e.maxAge&&(w[c].maxAge=e.maxAge),(w[c]||v.maxAge)&&("aggressive"!==w[c].deleteOnExpire&&"aggressive"!==v.deleteOnExpire||!w[c].maxAge&&!v.maxAge||i(c,w[c].maxAge||v.maxAge)),t(c),u>v.capacity&&this.remove(z.key),d}},this.get=function(a,b){var c,d,e=x[a],f=w[a];if(e&&f)return c=f.maxAge||v.maxAge,d=f.deleteOnExpire||v.deleteOnExpire,c&&"passive"===d&&(new Date).getTime()-f.timestamp>c?(this.remove(a),e=null,v.onExpire?(v.onExpire(a,f.value,b),void 0):b&&"function"==typeof b?(b(a,f.value),void 0):void 0):(q(e),t(a),f.value)},this.remove=function(a){var b=x[a];b&&(b===y&&(y=b.p),b===z&&(z=b.n),r(b.n,b.p),delete x[a],delete w[a],t(null),v.storageMode&&D.removeItem(A+".data."+a),u--)},this.removeAll=function(){if(v.storageMode&&D)for(var a=e(w),b=0;b<a.length;b++)D.removeItem(A+".data."+a[b]);w={},u=0,x={},y=null,z=null,t(null)},this.destroy=function(){v.cacheFlushIntervalId&&clearInterval(v.cacheFlushIntervalId),v.storageMode&&D&&(this.removeAll(),D.removeItem(A+".keys"),D.removeItem(A)),D=null,w=null,v=null,x=null,u=null,y=null,z=null,A=null,C=null,delete h[f]},this.info=function(a){if(a in w){var c={timestamp:w[a].timestamp,maxAge:w[a].maxAge||v.maxAge,deleteOnExpire:w[a].deleteOnExpire||v.deleteOnExpire,isExpired:!1};return c.maxAge&&(c.isExpired=(new Date).getTime()-c.timestamp>c.maxAge),c}return b.extend({},v,{size:u})},this.keySet=function(){return d(w)},this.keys=function(){return e(w)},this.setOptions=p,p(g,!0)}function g(a,c){if(a in h)throw new Error("cacheId "+a+" taken!");if(!b.isString(a))throw new Error("cacheId must be a string!");return h[a]=new f(a,c),h[a]}var h={};return g.info=function(){for(var a={},b=e(h),c=0;c<b.length;c++){var d=b[c];a[d]=h[d].info()}return a},g.get=function(a){return h[a]},g.keySet=function(){return d(h)},g.keys=function(){return e(h)},g.removeAll=function(){for(var a=e(h),b=0;b<a.length;b++)h[a[b]].destroy()},g.clearAll=function(){for(var a=e(h),b=0;b<a.length;b++)h[a[b]].removeAll()},g}]}b.module("angular-cache",["ng"]),b.module("angular-cache").provider("$angularCacheFactory",c)}(window,window.angular);